<!DOCTYPE html>
<html>
<head>
  <title>SuiFlow Widget Test - Updated</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 600px;
      margin: 50px auto;
      padding: 20px;
      background: #f8fafc;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #374151;
    }
    input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e5e7eb;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.2s;
    }
    input:focus {
      outline: none;
      border-color: #4f46e5;
    }
    .pay-button {
      background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%);
      color: white;
      padding: 14px 28px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
      width: 100%;
    }
    .pay-button:hover {
      transform: translateY(-2px);
    }
    .info {
      background: #f0f9ff;
      border: 1px solid #0ea5e9;
      border-radius: 8px;
      padding: 16px;
      margin-top: 20px;
    }
    .merchant-info {
      background: #f9fafb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #6b7280;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üöÄ SuiFlow Widget Integration Test</h1>
    
    <div class="merchant-info">
      <strong>Merchant ID:</strong> 687b8e4455ee9491cb288826<br>
      <strong>Integration:</strong> Widget Payment System
    </div>
    
    <div class="form-group">
      <label for="email">Email Address</label>
      <input 
        type="email" 
        id="email" 
        placeholder="Enter your email for receipt" 
        required
      />
    </div>
    
    <div class="form-group">
      <label for="amount">Amount (SUI)</label>
      <input 
        type="number" 
        id="amount" 
        placeholder="Enter payment amount" 
        min="0.01" 
        step="0.01" 
        value="0.1"
      />
    </div>
    
    <button class="pay-button" onclick="payWithSuiFlow()">
      üí≥ Pay with SuiFlow Widget
    </button>
    
    <div class="info">
      <strong>üìß New Feature: Email Receipts!</strong><br>
      Enter your email to receive detailed payment receipts automatically.<br><br>
      <strong>‚ÑπÔ∏è How it works:</strong><br>
      1. Enter your email address<br>
      2. Enter the amount you want to pay<br>
      3. Click "Pay with SuiFlow Widget"<br>
      4. Connect your SUI wallet in the popup<br>
      5. Confirm the transaction<br>
      6. Payment is automatically verified on blockchain<br>
      7. Both you and the merchant receive email receipts!
    </div>
  </div>

<<<<<<< HEAD
  <script src="sdk/suiflow.js"></script>
=======
  <script src="sdk/suiflow-enhanced.js"></script>
>>>>>>> main
  <script>
    function payWithSuiFlow() {
      const email = document.getElementById('email').value;
      const amount = parseFloat(document.getElementById('amount').value);
      
      // Validate email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email || !emailRegex.test(email)) {
        alert('Please enter a valid email address');
        return;
      }
      
      if (!amount || amount <= 0) {
        alert('Please enter a valid amount greater than 0');
        return;
      }
      
      console.log('Initiating payment with SuiFlow widget...');
      console.log('Email:', email);
      console.log('Amount:', amount, 'SUI');
      console.log('Merchant ID: 687b8e4455ee9491cb288826');
      
      // Check if SuiFlow SDK is loaded
      if (typeof window.Suiflow === 'undefined') {
        alert('SuiFlow SDK not loaded. Please ensure the script is included.');
        return;
      }
      
      Suiflow.payWithWidget({
        merchantId: '687b8e4455ee9491cb288826',
        amount: amount,
        onSuccess: function(txHash, paidAmount) {
          console.log('Payment successful!');
          console.log('Transaction Hash:', txHash);
          console.log('Paid Amount:', paidAmount);
          
          alert(`‚úÖ Payment Successful!\n\nAmount: ${paidAmount} SUI\nTransaction: ${txHash.slice(0, 8)}...${txHash.slice(-8)}\n\nüìß Receipt sent to: ${email}\n\nThis payment will now appear in the merchant's dashboard.`);
          
          // Here you could call your backend to update user balance, credits, etc.
          // Example: updateUserBalance(paidAmount);
        }
      });
    }
    
    // Optional: Update user balance after payment
    function updateUserBalance(amount) {
      // Call your backend API to credit the user's account
      console.log(`User should be credited ${amount} SUI worth of services/credits`);
      
      // Example: VTU/External System Integration
      // Convert SUI to local currency/credits (e.g., 1 SUI = 100 credits)
      const credits = amount * 100;
      
      // Call your VTU backend API
      fetch('/api/vtu/credit-user', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          userId: getCurrentUserId(), // Get current user
          amount: credits,
          txHash: txHash, // Blockchain proof
          currency: 'SUI',
          type: 'crypto_payment'
        })
      })
      .then(response => response.json())
      .then(data => {
        console.log('User balance updated:', data);
        // Update UI to show new balance
        updateBalanceDisplay(data.newBalance);
      })
      .catch(error => {
        console.error('Error updating balance:', error);
      });
    }
    
    function getCurrentUserId() {
      // Get current user ID from your authentication system
      return localStorage.getItem('userId') || 'user123';
    }
    
    function updateBalanceDisplay(newBalance) {
      // Update the balance display on your website
      const balanceElement = document.getElementById('user-balance');
      if (balanceElement) {
        balanceElement.textContent = `Balance: ${newBalance} credits`;
      }
    }
  </script>
</body>
</html>
